package ui

import (
	"time"

	"github.com/GeertJohan/go.rice/embedded"
)

func init() {

	// define files
	file2 := &embedded.EmbeddedFile{
		Filename:    "index.html",
		FileModTime: time.Unix(1574217492, 0),

		Content: string("<!DOCTYPE html>\r\n<html>\r\n<head>\r\n    <meta charset=\"gbk\"/>\r\n    <title>Xlsx2DB</title>\r\n    <style type=\"text/css\">\r\n        table {\r\n            border: 1px solid #000;\r\n            border-collapse:collapse;\r\n        }\r\n        table,th, td\r\n        {\r\n            border: 1px solid black;\r\n        }\r\n/*        body{\r\n            background-image: url(\"https://uploadbeta.com/api/pictures/random/?key=BingEverydayWallpaperPicture\");\r\n            background-repeat:no-repeat;\r\n            background-position:center;\r\n        }*/\r\n        .import-number-area,.table-area{\r\n\r\n            padding-top: 10px;\r\n            padding-bottom: 10px;\r\n        }\r\n\r\n    </style>\r\n</head>\r\n<body>\r\n\r\n<div>\r\n    <button id=\"btn-chose-table\">ѡ\xb1\xed</button><br/>\r\n    <span id=\"table\"></span>\r\n    <br/>\r\n    <button id=\"btn-chose-file\">ѡ\xceļ\xfe</button><br/>\r\n    <span id=\"filePath\"></span><br/><br/>\r\n\r\n    <div id=\"msg\"></div>\r\n\r\n    <button id=\"btn-sure\">\xcf\xd4ʾ\xd7ֶ\xce</button>\r\n    <button id=\"btn-import\">\xb5\xbc\xc8\xeb</button>\r\n    <div class=\"import-number-area\">\r\n        ÿ\xb4ε\xbc\xc8\xeb\xca\xfd\xc1\xbf\xa3\xba <input type=\"number\" id=\"import-number\" value=\"1000\"/>\r\n    </div>\r\n\r\n    <div class=\"table-area\">\r\n        <table>\r\n            <thead>\r\n            <tr>\r\n                <th>\xd0\xf2\xba\xc5</th>\r\n                <th>\xceļ\xfeͷ</th>\r\n                <th>\xb1\xed\xd7ֶ\xce</th>\r\n                <th>ѡ\xd6\xd0</th>\r\n            </tr>\r\n            </thead>\r\n            <tbody id=\"tb-content\">\r\n\r\n            </tbody>\r\n\r\n        </table>\r\n\r\n    </div>\r\n\r\n\r\n</div>\r\n<script type=\"text/tiscript\">\r\n\r\n\r\n  function msg(m){\r\n    $(#msg).text = m;\r\n  }\r\n   function start(){\r\n\r\n  }\r\n  function finish(){\r\n      view.msgbox(#alert, \"\xcd\xea\xb3\xc9\");\r\n  }\r\n  $(#btn-import).on(\"click\",function(){\r\n\r\n    var s = $(#table).text;\r\n    var trs = $$(#tb-content tr);\r\n    var ret = [];\r\n    for(var c in trs) {\r\n            if(c[3][0].getState(Element.STATE_CHECKED)) {\r\n              ret.push(\r\n                  {\r\n                    index:c[0].text.toInteger(),\r\n                    field:c[2][0].value\r\n                  }\r\n              );\r\n            }\r\n        }\r\n     var f = $(#filePath).text;\r\n     if(s.length == 0){\r\n     view.msgbox(#alert,\"\xc7\xeb\xcf\xc8ѡ\xb1\xed\");\r\n       return;\r\n     }\r\n     if(f.length == 0){\r\n     view.msgbox(#alert,\"\xc7\xebѡ\xceļ\xfe\");\r\n       return;\r\n     }\r\n     if(ret.length == 0){\r\n      view.msgbox(#alert,\"û\xd3\xd0Ҫ\xb5\xbc\xc8\xeb\xb5\xc4\xca\xfd\xbe\xdd\");\r\n       return;\r\n     }\r\n\r\n     msg('\xbf\xaaʼ\xb5\xbc\xc8\xeb...');\r\n     var dbn = s.split(\".\")[0];\r\n     var tbn = s.split(\".\")[1];\r\n     var num = $(#import-number).value;\r\n     if(num <= 0){\r\n       view.msgbox(#alert,\"\xb5\xbc\xc8\xeb\xca\xfd\xc1\xbf\xd3\xd0\xce\xf3\");\r\n       return;\r\n     }\r\n\r\n     view.importData(f,dbn,tbn,JSON.stringify(ret),num);\r\n  });\r\n\r\n   function getSelTabNames(i,t){\r\n     var select = Element.create([select:\"\"]);\r\n     select.attributes[\"id\"] = \"sel\"+i;\r\n     for(var i =0;i < t.length;i++){\r\n       var op = Element.create([option:t[i].columnName]);\r\n       op.value = t[i].columnName;\r\n       select.append(op);\r\n     }\r\n     return select;\r\n   }\r\n\r\n   function renderTables(f,t){\r\n\r\n      $(#tb-content).clear();\r\n      for(var i=0;i<f.length;i++){\r\n        var tr = Element.create([tr:\"\"]);\r\n        var ii = \"\"+f[i].index;\r\n        tr.append(Element.create([td:ii]));\r\n        var tt = f[i].title;\r\n        tr.append(Element.create([td:tt]));\r\n\r\n        var td = Element.create([td:\"\"]);\r\n        td.append(getSelTabNames(f[i].index,t));\r\n        tr.append(td);\r\n\r\n        var td1 = Element.create([td:\"\"]);\r\n\r\n        var ci = \"check\"+ii\r\n        var ck = Element.create([input:\"\"]);\r\n        ck.attributes[\"type\"] = \"checkbox\"\r\n        ck.attributes[\"id\"] = ci\r\n\r\n        td1.append(ck);\r\n        tr.append(td1);\r\n\r\n        $(#tb-content).append(tr);\r\n      }\r\n   }\r\n\r\n    view.setTable = function(db,tab){\r\n      $(#table).text = db+\".\"+tab\r\n    }\r\n    self.ready=function(){\r\n       $(#btn-sure).on(\"click\", function() {\r\n\r\n\r\n           var s = $(#table).text;\r\n           var f = $(#filePath).text;\r\n           var data = view.getTableInfos( s.split(\".\")[0], s.split(\".\")[1]);\r\n           data = JSON.parse(data);\r\n           if(data.err == 1){\r\n             view.msgbox(#alert, data.msg);\r\n             return;\r\n           }\r\n\r\n            if(data.err == 1){\r\n              view.msgbox(#alert, data.msg);\r\n              return;\r\n            }\r\n            msg('\xb6\xc1ȡ\xceļ\xfe...');\r\n            var data1 = view.getFileTitles(f);\r\n\r\n            msg('');\r\n\r\n            data1 = JSON.parse(data1);\r\n            if(data1.err == 1){\r\n              view.msgbox(#alert, data1.msg);\r\n              return;\r\n            }\r\n\r\n            renderTables(data1.data,data.data);\r\n\r\n\r\n\r\n       });\r\n       $(#btn-chose-table).on(\"click\", function() {\r\n          //var f = [{\"title\":\"aa\",\"index\":0},{\"title\":\"aa\",\"index\":1},{\"title\":\"aa\",\"index\":2},{\"title\":\"aa\",\"index\":3},{\"title\":\"aa\",\"index\":4},{\"title\":\"aa\",\"index\":5},{\"title\":\"aa\",\"index\":6},{\"title\":\"aa\",\"index\":7},{\"title\":\"aa\",\"index\":8},{\"title\":\"aa\",\"index\":9}];\r\n         // var t = [{\"columnName\":\"order_status_id\",\"columnType\":\"bigint(20)\"},{\"columnName\":\"id\",\"columnType\":\"varchar(64)\"},{\"columnName\":\"order_value\",\"columnType\":\"varchar(64)\"},{\"columnName\":\"mobile\",\"columnType\":\"varchar(20)\"},{\"columnName\":\"time\",\"columnType\":\"varchar(64)\"},{\"columnName\":\"product\",\"columnType\":\"varchar(64)\"},{\"columnName\":\"state\",\"columnType\":\"varchar(32)\"},{\"columnName\":\"SIM\",\"columnType\":\"varchar(64)\"},{\"columnName\":\"lgtsId\",\"columnType\":\"varchar(64)\"},{\"columnName\":\"create_at\",\"columnType\":\"datetime\"},{\"columnName\":\"bus_type\",\"columnType\":\"varchar(50)\"},{\"columnName\":\"update_at\",\"columnType\":\"datetime\"},{\"columnName\":\"state_last\",\"columnType\":\"varchar(32)\"}];\r\n          //renderTables(f,t);\r\n          view.dialog({url:\"table.html\",width:500,height:500});\r\n       });\r\n       $(#btn-chose-file).on(\"click\", function() {\r\n            const filter = \"xlsx Files|*.xlsx\";\r\n            const defaultExt = \"xlsx\";\r\n            const initialPath = System.path(#USER_DOCUMENTS);\r\n            const caption = \"ѡ\xd4\xf1xlsx\";\r\n            var file = view.selectFile(#open, filter, defaultExt, initialPath, caption );\r\n            $(#filePath).text = file;\r\n            return true;\r\n       });\r\n    }\r\n\r\n</script>\r\n</body>\r\n</html>"),
	}
	file3 := &embedded.EmbeddedFile{
		Filename:    "table.html",
		FileModTime: time.Unix(1568878845, 0),

		Content: string("<!DOCTYPE html>\r\n<html lang=\"en\">\r\n<head>\r\n    <meta charset=\"gbk\"/>\r\n    <title>ѡ\xb1\xed</title>\r\n    <style type=\"text/css\">\r\n\r\n        .data {\r\n            padding: 0px;\r\n            margin: 0px;\r\n            margin-top: 5px;\r\n            border-top: 1px solid #000;\r\n        }\r\n\r\n        .data ul {\r\n            padding: 0px;\r\n            margin: 0px;\r\n            width: 50%;\r\n            float: left\r\n        }\r\n        .data ul li {\r\n            cursor: pointer;\r\n            list-style-type:none;\r\n        }\r\n        .focus{\r\n            color: red;\r\n        }\r\n\r\n    </style>\r\n</head>\r\n<body>\r\n\r\n<div>\r\n    <select id=\"driver\" name=\"driver\">\r\n        <option value=\"mysql\">mysql</option>\r\n    </select>\r\n    \xca\xfd\xbe\xddԴ: <input id=\"source\" name=\"source\" type=\"text\" value=\"\" placeholder=\"\xca\xfd\xbe\xddԴ\"/>\r\n    <button id=\"sure\">ȷ\xc8\xcf</button><br/>\r\n    \xca\xfd\xbe\xddԴ\xc0\xfd\xd7ӣ\xbauser:password@tcp(host:port)/db?charset=utf8\r\n</div>\r\n<div class=\"data\">\r\n    <ul id=\"db-names\">\r\n    </ul>\r\n    <ul id=\"db-tables\">\r\n\r\n    </ul>\r\n</div>\r\n<script type=\"text/tiscript\">\r\n\r\n    function renderTables(db){\r\n        var data = view.parent.getTableName(db);\r\n        data = JSON.parse(data);\r\n        if(data.err == 1){\r\n            view.msgbox(#alert, data.msg);\r\n            return;\r\n         }\r\n        $(#db-tables).clear();\r\n        for (var i = 0 ; i < data.data.length;i++){\r\n            var li = Element.create([li:data.data[i]])\r\n            li.on(\"click\",function(){\r\n                view.parent.setTable(db,this.text)\r\n                view.close();\r\n            });\r\n            $(#db-tables).append(li);\r\n        }\r\n    }\r\n    $(#sure).on(\"click\",function () {\r\n\r\n\r\n        var d = $(#driver).value;\r\n        var s = $(input[name='source']).value.trim();\r\n        if (d.length === 0||s.length ===0){\r\n            view.msgbox(#alert, \"\xc7\xeb\xcf\xc8ѡ\xb1\xed\");\r\n            return;\r\n        }\r\n        view.parent.setDBSource(d,s);\r\n        var data = view.parent.getDBName()\r\n        data = JSON.parse(data);\r\n        if(data.err == 1){\r\n         view.msgbox(#alert, data.msg);\r\n        }else{\r\n\r\n        $(#db-names).clear();\r\n          for (var i = 0 ; i < data.data.length;i++){\r\n             var li = Element.create([li:data.data[i]])\r\n             li.on(\"click\",function(){\r\n                $$(#db-names > li).every(function(el){\r\n                  el.attributes.removeClass(\"focus\");\r\n                  return true;\r\n                });\r\n                this.attributes.addClass(\"focus\");\r\n                renderTables(this.text);\r\n             });\r\n             $(#db-names).append(li);\r\n          }\r\n        }\r\n    });\r\n</script>\r\n</body>\r\n</html>"),
	}

	// define dirs
	dir1 := &embedded.EmbeddedDir{
		Filename:   "",
		DirModTime: time.Unix(1574217492, 0),
		ChildFiles: []*embedded.EmbeddedFile{
			file2, // "index.html"
			file3, // "table.html"

		},
	}

	// link ChildDirs
	dir1.ChildDirs = []*embedded.EmbeddedDir{}

	// register embeddedBox
	embedded.RegisterEmbeddedBox(`assets`, &embedded.EmbeddedBox{
		Name: `assets`,
		Time: time.Unix(1574217492, 0),
		Dirs: map[string]*embedded.EmbeddedDir{
			"": dir1,
		},
		Files: map[string]*embedded.EmbeddedFile{
			"index.html": file2,
			"table.html": file3,
		},
	})
}
